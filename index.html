<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Modern Snake — Deluxe</title>
<style>
  :root{
    --bg-1: #020617;
    --bg-2: #06152a;
    --accent-a: #00ffb3;
    --accent-b: #ff00fb;
    --muted: rgba(255,255,255,0.85);
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  html,body{
    height:100%;
    margin:0;
    font-family: Inter, system-ui, "Segoe UI", Roboto, Arial;
    background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
    color: #e6eef8;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    user-select:none;
  }
  .wrap{display:flex;flex-direction:column;height:100vh;gap:12px;padding:12px;}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:6px 8px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent-a),var(--accent-b));display:flex;align-items:center;justify-content:center;font-weight:700;color:#021018}
  .stats{display:flex;gap:8px;align-items:center}
  .chip{background:var(--glass);padding:8px 12px;border-radius:12px;font-size:14px;color:var(--muted);backdrop-filter: blur(6px);border:1px solid rgba(255,255,255,0.03)}
  .stage{position:relative;flex:1;display:flex;align-items:center;justify-content:center;min-height:260px}
  canvas{border-radius:14px;box-shadow:0 20px 50px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);touch-action:none;max-width:100%;width:100%;height:auto;max-height: calc(100vh - 220px)}
  .controls-col{display:flex;flex-direction:column;gap:8px;align-items:flex-end}
  label{font-size:13px;color:var(--muted);display:flex;align-items:center;gap:8px}
  select, button, input[type=checkbox]{font-size:13px;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:var(--muted)}
  .btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--accent-a),var(--accent-b));color:#021018;font-weight:700}
  .overlay-center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
  .msg{pointer-events:auto;background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));padding:18px 22px;border-radius:14px;text-align:center;min-width:240px;border:1px solid rgba(255,255,255,0.03)}
  .touch-pad{position:absolute;right:16px;bottom:16px;display:grid;grid-template-columns:repeat(3,64px);grid-template-rows:repeat(3,64px);gap:10px;z-index:40}
  .touch-pad button{width:64px;height:64px;border-radius:50%;border:none;background: rgba(255,255,255,0.03);color:var(--muted);font-size:22px;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 20px rgba(3,8,20,0.5);backdrop-filter: blur(6px)}
  .touch-pad button:active{transform:scale(0.96)}
  @media (max-width:520px){
    .touch-pad{grid-template-columns:repeat(3,56px);grid-template-rows:repeat(3,56px)}
    .touch-pad button{width:56px;height:56px;font-size:20px}
    .logo{width:40px;height:40px}
  }
  /* place directional buttons in 3x3 grid positions */
  .btn-up{grid-column:2;grid-row:1}
  .btn-left{grid-column:1;grid-row:2}
  .btn-down{grid-column:2;grid-row:3}
  .btn-right{grid-column:3;grid-row:2}

  .footer-hint{font-size:13px;color:var(--muted);text-align:center;padding:8px 0}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo">S</div>
      <div>
        <div style="font-weight:800">Modern Snake</div>
        <div style="font-size:12px;color:var(--muted)">Neon • Dokunmatik • WebAudio</div>
      </div>
    </div>

    <div class="stats">
      <div class="chip" id="scoreChip">Puan: 0</div>
      <div class="chip" id="highChip">En Yüksek: 0</div>
      <button class="btn" id="pauseBtn">Duraklat</button>
      <button class="btn primary" id="restartBtn">Yeniden Başla</button>
    </div>
  </div>

  <div class="stage">
    <canvas id="game" width="720" height="720" aria-label="Snake game"></canvas>

    <div class="overlay-center" id="overlay"></div>

    <div style="position:absolute;right:18px;top:18px;display:flex;flex-direction:column;gap:8px;align-items:flex-end;">
      <label>
        Tema:
        <select id="themeSelect">
          <option value="night">Gece</option>
          <option value="neon">Neon</option>
          <option value="pastel">Pastel</option>
        </select>
      </label>
      <label>
        Zorluk:
        <select id="diffSelect">
          <option value="easy">Kolay</option>
          <option value="normal" selected>Normal</option>
          <option value="hard">Zor</option>
        </select>
      </label>
      <label style="align-items:center">
        <input type="checkbox" id="wrapToggle" checked />&nbsp;Ekran Sarma (Wrap)
      </label>
    </div>

    <div class="touch-pad" id="touchPad" aria-hidden="false">
      <button class="btn-up" data-dir="up" aria-label="Yukarı">▲</button>
      <button class="btn-left" data-dir="left" aria-label="Sol">◄</button>
      <button class="btn-down" data-dir="down" aria-label="Aşağı">▼</button>
      <button class="btn-right" data-dir="right" aria-label="Sağ">►</button>
    </div>
  </div>

  <div class="footer-hint">Swipe veya ok tuşları ile yönlendir. Ekranın altındaki butonlar mobil için.</div>
</div>

<script>
(() => {
  // DOM
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d', { alpha: false });
  const scoreChip = document.getElementById('scoreChip');
  const highChip = document.getElementById('highChip');
  const overlay = document.getElementById('overlay');
  const pauseBtn = document.getElementById('pauseBtn');
  const restartBtn = document.getElementById('restartBtn');
  const touchPad = document.getElementById('touchPad');
  const themeSelect = document.getElementById('themeSelect');
  const diffSelect = document.getElementById('diffSelect');
  const wrapToggle = document.getElementById('wrapToggle');

  // WebAudio helpers (no files)
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  let audioCtx = null;
  function ensureAudio(){ if(!audioCtx) audioCtx = new AudioCtx(); }
  function playClick(){ try{ ensureAudio(); const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.type='square'; o.frequency.value = 900; g.gain.value = 0.06; o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.05);}catch(e){}}
  function playPop(){ try{ ensureAudio(); const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.type='sine'; o.frequency.setValueAtTime(520,audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(260,audioCtx.currentTime+0.14); g.gain.setValueAtTime(0.08,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.15); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.16);}catch(e){}}
  function playFail(){ try{ ensureAudio(); const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.type='sawtooth'; o.frequency.setValueAtTime(160,audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(70,audioCtx.currentTime+0.4); g.gain.setValueAtTime(0.12,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.45); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.46);}catch(e){}}

  // Themes & difficulties
  const themes = {
    night: { bg1:'#0f1724', bg2:'#071426', snakeA:'#7b61ff', snakeB:'#00e6a8', apple1:'#ff7a64', apple2:'#ff5040' },
    neon:  { bg1:'#020617', bg2:'#06152a', snakeA:'#00ffb3', snakeB:'#ff00fb', apple1:'#fff000', apple2:'#ff5500' },
    pastel:{ bg1:'#f6f8ff', bg2:'#eaf1ff', snakeA:'#9bb4ff', snakeB:'#a6ffc8', apple1:'#ff9bb3', apple2:'#ff6f91' }
  };
  const difficulties = {
    easy: { baseSpeed:5, inc:0.18, initialLength:5 },
    normal:{ baseSpeed:8, inc:0.3, initialLength:4 },
    hard: { baseSpeed:12, inc:0.45, initialLength:3 }
  };

  // State
  const gridCols = 24, gridRows = 24;
  let deviceRatio = window.devicePixelRatio || 1;
  let grid = { cols:gridCols, rows:gridRows, cell: Math.floor(canvas.width / gridCols), width:0, height:0 };
  let snake = [], dir = {x:1,y:0}, nextDir = null, apple = null;
  let score = 0, high = parseInt(localStorage.getItem('modernSnakeHigh')||'0',10);
  let speed = difficulties.normal.baseSpeed, speedInc = difficulties.normal.inc, moveInterval = 1000/speed;
  let running = true, last = 0, acc = 0, gameOver = false;
  let wrapEnabled = true;
  let currentTheme = 'neon';

  highChip.textContent = 'En Yüksek: ' + high;

  function resizeCanvas(){
    const maxW = Math.min(window.innerWidth - 48, window.innerHeight*0.9);
    const size = Math.max(280, Math.min(800, Math.floor(maxW)));
    canvas.style.width = size+'px'; canvas.style.height = size+'px';
    deviceRatio = window.devicePixelRatio || 1;
    canvas.width = Math.floor(size * deviceRatio);
    canvas.height = Math.floor(size * deviceRatio);
    ctx.setTransform(deviceRatio,0,0,deviceRatio,0,0);
    grid.cell = Math.floor(size / grid.cols);
    grid.width = grid.cell * grid.cols;
    grid.height = grid.cell * grid.rows;
    canvas.style.width = grid.width + 'px';
    canvas.style.height = grid.height + 'px';
    draw();
  }
  window.addEventListener('resize', resizeCanvas);

  function rnd(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

  function placeApple(){
    let tries=0;
    while(tries++ < 2000){
      const x = rnd(0,grid.cols-1), y = rnd(0,grid.rows-1);
      if(!snake.some(p => p.x===x && p.y===y)){ apple={x,y}; return; }
    }
    apple = {x:0,y:0};
  }

  function resetGame(){
    snake = [];
    const sx = Math.floor(grid.cols/2), sy = Math.floor(grid.rows/2);
    const d = difficulties[diffSelect.value] || difficulties.normal;
    speed = d.baseSpeed; speedInc = d.inc;
    const initLen = d.initialLength;
    for(let i=0;i<initLen;i++) snake.push({x: sx-i, y: sy});
    dir = {x:1,y:0}; nextDir = null;
    score = 0; moveInterval = 1000/speed; running = true; gameOver=false;
    placeApple(); scoreChip.textContent = 'Puan: ' + score;
    updateTheme(themeSelect.value);
    startLoop();
  }

  function updateTheme(t){
    currentTheme = t;
    const th = themes[t];
    document.documentElement.style.setProperty('--bg-1', th.bg1);
    document.documentElement.style.setProperty('--bg-2', th.bg2);
    document.documentElement.style.setProperty('--accent-a', th.snakeA);
    document.documentElement.style.setProperty('--accent-b', th.snakeB);
    draw();
  }

  // Drawing
  function drawGrid(){
    const c = ctx;
    c.clearRect(0,0,grid.width,grid.height);
    const th = themes[currentTheme];
    const g = c.createLinearGradient(0,0,0,grid.height);
    g.addColorStop(0, th.bg1);
    g.addColorStop(1, th.bg2);
    c.fillStyle = g;
    roundRect(c, 0, 0, grid.width, grid.height, 12); c.fill();

    // faint grid lines
    c.strokeStyle = 'rgba(255,255,255,0.02)';
    c.lineWidth = 1;
    for(let x=0;x<=grid.width;x+=grid.cell){ c.beginPath(); c.moveTo(x+0.5,0); c.lineTo(x+0.5,grid.height); c.stroke(); }
    for(let y=0;y<=grid.height;y+=grid.cell){ c.beginPath(); c.moveTo(0,y+0.5); c.lineTo(grid.width,y+0.5); c.stroke(); }
  }

  function drawApple(){
    if(!apple) return;
    const s = grid.cell;
    const x = apple.x * s, y = apple.y * s;
    const cx = x + s/2, cy = y + s/2, r = s*0.36;
    const th = themes[currentTheme];
    const g = ctx.createRadialGradient(cx,cy,r*0.1,cx,cy,r*1.2);
    g.addColorStop(0, th.apple1); g.addColorStop(1, th.apple2);
    ctx.fillStyle = g; circle(ctx, cx, cy, r); ctx.fill();
    ctx.fillStyle = 'rgba(255,255,255,0.6)'; circle(ctx, cx - r*0.35, cy - r*0.35, r*0.12); ctx.fill();
  }

  function drawSnake(){
    if(!snake.length) return;
    const s = grid.cell;
    for(let i=snake.length-1;i>=0;i--){
      const p = snake[i];
      const px = p.x * s, py = p.y * s;
      const t = 1 - (i / snake.length);
      const color = lerpColor(themes[currentTheme].snakeA, themes[currentTheme].snakeB, t);
      roundRect(ctx, px+2, py+2, s-4, s-4, 6);
      ctx.fillStyle = color; ctx.fill();
    }
    // head sheen
    const head = snake[0];
    ctx.fillStyle = 'rgba(255,255,255,0.08)';
    circle(ctx, head.x*s + s/2 - s*0.08, head.y*s + s/2 - s*0.18, s*0.12); ctx.fill();
  }

  function drawGlow(){
    const g = ctx.createRadialGradient(0,0,30, grid.width*0.6, grid.height*0.4, Math.max(grid.width,grid.height));
    g.addColorStop(0, hexToRgba(themes[currentTheme].snakeB, 0.06));
    g.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = g; ctx.fillRect(0,0,grid.width,grid.height);
  }

  function draw(){
    drawGrid(); drawApple(); drawSnake(); drawGlow();
  }

  // helpers
  function roundRect(c,x,y,w,h,r){ c.beginPath(); c.moveTo(x+r,y); c.arcTo(x+w,y,x+w,y+h,r); c.arcTo(x+w,y+h,x,y+h,r); c.arcTo(x,y+h,x,y,r); c.arcTo(x,y,x+w,y,r); c.closePath(); }
  function circle(c,x,y,r){ c.beginPath(); c.arc(x,y,r,0,Math.PI*2); c.closePath(); }
  function lerpColor(a,b,t){ const pa=parseInt(a.slice(1),16), pb=parseInt(b.slice(1),16); const ar=(pa>>16)&255,ag=(pa>>8)&255,ab=pa&255; const br=(pb>>16)&255,bg=(pb>>8)&255,bb=pb&255; const rr=Math.round(ar+(br-ar)*t), rg=Math.round(ag+(bg-ag)*t), rb=Math.round(ab+(bb-ab)*t); return `rgb(${rr},${rg},${rb})`; }
  function hexToRgba(hex, a){ if(hex.startsWith('#')) hex = hex.slice(1); if(hex.length===3) hex = hex.split('').map(c=>c+c).join(''); const r=parseInt(hex.slice(0,2),16), g=parseInt(hex.slice(2,4),16), b=parseInt(hex.slice(4,6),16); return `rgba(${r},${g},${b},${a})`; }

  // game logic
  function step(){
    if(gameOver || !running) return;
    if(nextDir){ if(!(nextDir.x === -dir.x && nextDir.y === -dir.y)) dir = nextDir; nextDir = null; }
    const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
    if(wrapToggle.checked){
      if(head.x < 0) head.x = grid.cols - 1;
      if(head.x >= grid.cols) head.x = 0;
      if(head.y < 0) head.y = grid.rows - 1;
      if(head.y >= grid.rows) head.y = 0;
    } else {
      if(head.x < 0 || head.x >= grid.cols || head.y < 0 || head.y >= grid.rows){ return endGame(); }
    }
    if(snake.some(p => p.x === head.x && p.y === head.y)) return endGame();
    snake.unshift(head);
    if(apple && head.x === apple.x && head.y === apple.y){
      score += 10; playPop();
      speed = Math.min(60, speed + speedInc);
      moveInterval = 1000 / speed;
      placeApple();
      scoreChip.textContent = 'Puan: ' + score;
      if(score > high){ high = score; localStorage.setItem('modernSnakeHigh', String(high)); highChip.textContent = 'En Yüksek: ' + high; }
    } else {
      snake.pop();
    }
  }

  function endGame(){
    gameOver = true; running = false; playFail();
    updateOverlay(`<div class="msg"><h3>Oyun Bitti</h3><p>Puanın: ${score}</p><div style="display:flex;gap:8px;justify-content:center;margin-top:10px;"><button class="btn" id="overlayRestart">Tekrar Oyna</button></div></div>`);
    setTimeout(()=>{ const r=document.getElementById('overlayRestart'); if(r) r.addEventListener('click', ()=>{ resetGame(); startLoop(); updateOverlay(''); }); },10);
  }

  function updateOverlay(html){ overlay.innerHTML = html || ''; }

  // loop
  function loop(ts){
    if(!last) last = ts;
    const delta = ts - last; last = ts; acc += delta;
    while(acc >= moveInterval){ step(); acc -= moveInterval; }
    draw();
    if(!gameOver && running) requestAnimationFrame(loop);
  }
  function startLoop(){ last = 0; acc = 0; if(!gameOver) requestAnimationFrame(loop); running = true; }

  // input: keyboard (arrow keys)
  window.addEventListener('keydown', e=>{
    if(gameOver) return;
    if(e.repeat) return;
    const k = e.key;
    if(k === 'ArrowUp' || k === 'w'){ nextDir = {x:0,y:-1}; playClick(); }
    if(k === 'ArrowDown' || k === 's'){ nextDir = {x:0,y:1}; playClick(); }
    if(k === 'ArrowLeft' || k === 'a'){ nextDir = {x:-1,y:0}; playClick(); }
    if(k === 'ArrowRight' || k === 'd'){ nextDir = {x:1,y:0}; playClick(); }
    if(k === ' '){ togglePause(); }
  });

  // touch swipe detection on canvas
  let touchStart = null, touchId = null;
  const swipeThreshold = 20;
  canvas.addEventListener('touchstart', ev => {
    const t = ev.changedTouches[0];
    touchStart = { x: t.clientX, y: t.clientY, time: Date.now() };
    touchId = t.identifier;
  }, { passive:true });
  canvas.addEventListener('touchmove', ev => { ev.preventDefault(); }, { passive:false });
  canvas.addEventListener('touchend', ev => {
    const t = Array.from(ev.changedTouches).find(tt=>tt.identifier===touchId) || ev.changedTouches[0];
    if(!t || !touchStart) return;
    const dx = t.clientX - touchStart.x, dy = t.clientY - touchStart.y;
    if(Math.abs(dx) < swipeThreshold && Math.abs(dy) < swipeThreshold){
      togglePause();
    } else {
      if(Math.abs(dx) > Math.abs(dy)){
        setDir(dx>0 ? {x:1,y:0} : {x:-1,y:0});
      } else {
        setDir(dy>0 ? {x:0,y:1} : {x:0,y:-1});
      }
    }
    touchStart = null; touchId = null;
  }, { passive:true });

  function setDir(d){ if(d.x === -dir.x && d.y === -dir.y) return; nextDir = d; }

  // on-screen buttons (touch / mouse)
  touchPad.addEventListener('pointerdown', e=>{
    const btn = e.target.closest('button[data-dir]');
    if(!btn) return;
    const d = btn.dataset.dir;
    if(d === 'up') setDir({x:0,y:-1});
    if(d === 'down') setDir({x:0,y:1});
    if(d === 'left') setDir({x:-1,y:0});
    if(d === 'right') setDir({x:1,y:0});
    try{ btn.setPointerCapture(e.pointerId); btn.addEventListener('pointerup', ()=>{ try{btn.releasePointerCapture(e.pointerId);}catch(_){} }, { once:true }); }catch(e){}
    playClick();
  });

  // UI
  pauseBtn.addEventListener('click', ()=>{ playClick(); togglePause(); });
  restartBtn.addEventListener('click', ()=>{ playClick(); resetGame(); startLoop(); updateOverlay(''); pauseBtn.textContent='Duraklat'; });

  themeSelect.addEventListener('change', (e)=>{ playClick(); updateTheme(e.target.value); });
  diffSelect.addEventListener('change', (e)=>{ playClick(); resetGame(); });
  wrapToggle.addEventListener('change', ()=>{ playClick(); });

  function togglePause(){ if(gameOver) return; running = !running; pauseBtn.textContent = running ? 'Duraklat' : 'Devam Et'; if(running) { last = 0; requestAnimationFrame(loop); updateOverlay(''); } else { updateOverlay(`<div class="msg"><h4>Duraklatıldı</h4><p>Devam etmek için butona bas veya ekrana dokun.</p></div>`); } }

  // init helpers
  function resetIntervalFromSpeed(){ moveInterval = 1000 / speed; }

  // init
  function init(){
    resizeCanvas();
    updateTheme(themeSelect.value);
    resetGame();
    startLoop();
  }

  // expose for debugging
  window.ModernSnake = { resetGame, step };

  // Start
  init();

})();
</script>
</body>
</html>
